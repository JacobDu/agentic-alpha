# HEA-2026-02-18-04

## 1) hea_round
- hea_round: HEA-2026-02-18-04
- date: 2026-02-18
- owner: agent

## 2) hypothesis
- hypothesis: 将 HEA 三轮筛选的 Top-30 因子（20 single + 10 composite）加入 Alpha158 基线，通过 LightGBM 训练 + 含成本回测，验证因子组合的实际投资价值
- market_logic: HEA 因子具有与 Alpha158 正交的预测信号（波动率 CV、换手分位数、跳空频率等），纳入后可提升模型的信号多样性和组合表现
- expected_direction: 正向提升超额收益与 IR

## 3) factor_expression_list
- handler: HEATopFactors (Alpha158 158 factors + 20 single + 10 composite = ~188 features)
- 因子来源: factor_library.db 中 status=Accepted 且 |ICIR| 最高的 HEA 因子
- composite_top_10: COMP_TRIPLE_TQ_CV_GAP, COMP_TQ120_p_AMTCV20, COMP_VOLCV10_p_CFP, COMP_TQ120_x_GAPFREQ, COMP_TQ120_x_AMTCV20, COMP_VALLV_div_CFP, COMP_GAPFREQ_x_VOLTREND, COMP_VWAPBIAS_x_VOLCONC, COMP_TQ120_p_GAPFREQ, COMP_Z_TQ120_m_AMTCV
- single_top_20: From NEW_/ORTH_/CSTM_ families, filtered for component-composite redundancy

## 4) preflight_gate
- parse_ok: pass (HEATopFactors handler successfully loads from DB)
- complexity_level: high (188 features, LightGBM training + full backtest)
- redundancy_flag: low (composite-component dedup applied in handler)
- data_availability: pass (all fields available in csi1000)
- gate_notes: Handler deduplicates by excluding single factors that are components of selected composites

## 5) experiment_config
- script: scripts/run_phase2_comparison.py
- market: csi1000
- start: 2018-01-01
- end: 2024-12-31
- segments:
  - train: 2018-01-01 ~ 2022-12-31
  - valid: 2023-01-01 ~ 2023-12-31
  - test: 2024-01-01 ~ 2024-12-31
- model: LGBModel (loss=mse, lr=0.05, max_depth=8, num_leaves=128, n_estimators=1000, early_stopping=50)
- backtest: TopkDropoutStrategy (topk=50, n_drop=5, open_cost=0.0005, close_cost=0.0015, account=100M)
- benchmark: SH000852
- run_id: N/A (standalone run, not mlflow-tracked)
- output_paths:
  - outputs/logs/phase2_baseline_alpha158.log
  - outputs/logs/phase2_hea_top_factors.log
  - outputs/phase2_comparison.json

## 6) layer_a_single_factor
> Layer A 在这里描述的是 LightGBM 模型的信号预测能力（模型层面 IC）

### Baseline Alpha158:
- IC: 0.0365
- ICIR: 0.302
- Rank IC: 0.0238
- Rank ICIR: 0.177

### HEA Top Factors (Alpha158 + 30 HEA):
- IC: 0.0371
- ICIR: 0.298
- Rank IC: 0.0242
- Rank ICIR: 0.173

### 对比:
- IC 微升 +1.8%，ICIR 微降 -1.2%（基本持平）
- 模型信号层面两者差异不大，HEA 因子的价值主要体现在组合层
- layer_a_result: pass (IC > 0.03, p significant)

## 7) layer_b_portfolio
- executed: yes

### Baseline Alpha158:
- excess_return_without_cost: -7.56% (annualized)
- ir_without_cost: -0.529
- max_drawdown_without_cost: -14.3%
- excess_return_with_cost: -11.86% (annualized)
- ir_with_cost: -0.831
- max_drawdown_with_cost: -16.3%

### HEA Top Factors:
- excess_return_without_cost: -2.03% (annualized)
- ir_without_cost: -0.149
- max_drawdown_without_cost: -12.5%
- excess_return_with_cost: -6.37% (annualized)
- ir_with_cost: -0.469
- max_drawdown_with_cost: -12.8%

### 对比改善:
| 指标 | Baseline | HEA | Delta | 改善% |
|------|----------|-----|-------|-------|
| Excess Ann Ret (no cost) | -7.56% | -2.03% | +5.53pp | +73.1% |
| IR (no cost) | -0.529 | -0.149 | +0.380 | +71.8% |
| Max DD (no cost) | -14.3% | -12.5% | +1.9pp | +13.1% |
| Excess Ann Ret (with cost) | -11.86% | -6.37% | +5.49pp | **+46.3%** |
| IR (with cost) | -0.831 | -0.469 | +0.362 | **+43.6%** |
| Max DD (with cost) | -16.3% | -12.8% | +3.5pp | **+21.6%** |

- layer_b_result: **fail** (超额收益仍为负值，未跑赢基准)

## 8) decision
- decision: Iterate
- decision_basis: Layer A pass（IC 持平），Layer B fail（超额收益为负），但 **HEA 因子相对 Baseline 改善显著（超额收益提升 5.49pp，IR 提升 0.36，最大回撤降低 3.5pp）**。HEA 因子库本身有价值，但当前策略/模型参数在 2024 测试期未能产生正超额。
- failure_mode: 2024 年 CSI1000 市场风格不利于当前策略（小盘股回调、量化拥挤等）。TopK50 + daily rebalance 可能不是最优配置（经验速记 #12 指出双周调仓最优）。
- next_action:
  1. **调仓频率优化**：切换到 hold=10（双周调仓）重新回测，预期 IR 大幅提升
  2. **多期测试**：在 2021-2023 等不同测试期验证策略表现
  3. **TopK 优化**：测试 TopK=30/100 等不同持仓数
  4. **模型调参**：测试 XGBoost、不同 num_leaves/learning_rate
  5. **加入财务因子**：Phase 2 财务数据可能补充额外预测信号

## 9) evidence_links
- db_query: `uv run python scripts/factor_db_cli.py list --market csi1000 --top 30`
- run_id: N/A (standalone)
- outputs:
  - outputs/logs/phase2_baseline_alpha158.log
  - outputs/logs/phase2_hea_top_factors.log
  - outputs/phase2_comparison.json
  - configs/workflow_csi1000_baseline_alpha158.yaml
  - configs/workflow_csi1000_hea_lightgbm.yaml
  - src/project_qlib/factors/hea_top_factors.py
