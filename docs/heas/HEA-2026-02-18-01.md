# HEA-2026-02-18-01

## 1) hea_round
- hea_round: HEA-2026-02-18-01
- date: 2026-02-18
- owner: agent

## 2) hypothesis
- hypothesis: 量价+估值字段中存在大量未被开发的因子组合，特别是估值波动率、估值×换手率交互、多尺度均值回归、微观结构、换手率体制变化等领域。
- market_logic: 已有因子库集中在 volume/range/kbar 类别，而 $pe_ttm/$pb_mrq/$ps_ttm/$pcf_ttm 估值字段及其与量价的交互几乎未被探索。CSI1000 小盘股展现强均值回归+低波动溢价特征，新因子设计围绕此特征展开。
- expected_direction: 负 IC 为主（低波动/低换手/低估值分位 → 正收益，符合均值回归逻辑）

## 3) factor_expression_list

**A. 估值波动率 (val_vol, 4个)**
- NEW_PE_CV_60 = `Div(Std($pe_ttm, 60), Mean(Abs($pe_ttm), 60) + 1e-8)`
- NEW_PB_CV_60 = `Div(Std($pb_mrq, 60), Mean(Abs($pb_mrq), 60) + 1e-8)`
- NEW_PS_CV_60 = `Div(Std($ps_ttm, 60), Mean(Abs($ps_ttm), 60) + 1e-8)`
- NEW_PE_PRICE_VOL_RATIO = `Div(Std($pe_ttm, 20), Mean(Abs($pe_ttm), 20) + 1e-8) / (Std($close, 20) / (Mean($close, 20) + 1e-8) + 1e-8)`

**B. 估值×换手率 (val_turn, 4个)**
- NEW_BP_TURN = `Mul(Div(1, $pb_mrq + 1e-8), $turnover_rate)`
- NEW_EP_TURN_SURGE = `Mul(Div(1, $pe_ttm + 1e-8), Div(Mean($turnover_rate, 5), Mean($turnover_rate, 60) + 1e-8))`
- NEW_SP_AMT_SURGE = `Mul(Div(1, $ps_ttm + 1e-8), Div($amount, Mean($amount, 60) + 1e-8))`
- NEW_CFP_TURN = `Mul(Div(1, Abs($pcf_ttm) + 1e-8), Mean($turnover_rate, 5))`

**C. 多尺度动量差 (momentum_diff, 5个)**
- NEW_MOM_DIFF_5_20 = `Div($close, Ref($close, 5)) - Div($close, Ref($close, 20))`
- NEW_MOM_DIFF_20_60 = `Div($close, Ref($close, 20)) - Div($close, Ref($close, 60))`
- NEW_MOM_DIFF_5_60 = `Div($close, Ref($close, 5)) - Div($close, Ref($close, 60))`
- NEW_MOM_ACCEL_5 = `(Div($close, Ref($close, 5)) - Div(Ref($close, 5), Ref($close, 10))) / (Std(Div($close, Ref($close, 1)) - 1, 10) + 1e-8)`
- NEW_MOM_DIFF_10_60 = `Div($close, Ref($close, 10)) - Div($close, Ref($close, 60))`

**D. 估值分位 (val_quantile, 5个)**
- NEW_PE_QUANTILE_120 = `Div($pe_ttm - Min($pe_ttm, 120), Max($pe_ttm, 120) - Min($pe_ttm, 120) + 1e-8)`
- NEW_PB_QUANTILE_120 = `Div($pb_mrq - Min($pb_mrq, 120), Max($pb_mrq, 120) - Min($pb_mrq, 120) + 1e-8)`
- NEW_PE_QUANTILE_240 = `Div($pe_ttm - Min($pe_ttm, 240), Max($pe_ttm, 240) - Min($pe_ttm, 240) + 1e-8)`
- NEW_CLOSE_QUANTILE_120 = `Div($close - Min($close, 120), Max($close, 120) - Min($close, 120) + 1e-8)`
- NEW_TURN_QUANTILE_120 = `Div($turnover_rate - Min($turnover_rate, 120), Max($turnover_rate, 120) - Min($turnover_rate, 120) + 1e-8)`

**E. 换手率体制 (turn_regime, 4个)**
- NEW_TURN_PERSIST_20 = `Corr($turnover_rate, Ref($turnover_rate, 1), 20)`
- NEW_TURN_TREND = `Div(Mean($turnover_rate, 5), Mean($turnover_rate, 20) + 1e-8) - Div(Ref(Mean($turnover_rate, 5), 10), Ref(Mean($turnover_rate, 20), 10) + 1e-8)`
- NEW_TURN_PEAK_20 = `Div(Max($turnover_rate, 20), Mean($turnover_rate, 20) + 1e-8)`
- NEW_AMT_SKEW_20 = `Div(Max($amount, 20) - Mean($amount, 20), Std($amount, 20) + 1e-8)`

**F. 微观结构 (microstructure, 6个)**
- NEW_VWAP_DEV = `Div($vwap - $close, $close + 1e-8)`
- NEW_VWAP_DEV_MA10 = `Mean(Div($vwap - $close, $close + 1e-8), 10)`
- NEW_AMT_PER_RANGE = `Div($amount, ($high - $low) + 1e-8)`
- NEW_VOL_CONC_5 = `Div(Max($volume, 5), Sum($volume, 5) + 1e-8)`
- NEW_CLOSE_POS = `Div($close - $low, $high - $low + 1e-8)`
- NEW_CLOSE_POS_MA10 = `Mean(Div($close - $low, $high - $low + 1e-8), 10)`

**G. 价格效率 (efficiency, 3个)**
- NEW_AMIHUD_20 = `Mean(Div(Abs(Div($close, Ref($close, 1)) - 1), $amount + 1e-8), 20)`
- NEW_PRICE_IMPACT_20 = `Mean(Div(Abs(Div($close, Ref($close, 1)) - 1), $turnover_rate + 1e-8), 20)`
- NEW_RET_PER_VOL_5 = `Div(Abs(Div($close, Ref($close, 5)) - 1), Mean($volume, 5) + 1e-8)`

**H. 均值回归 (mean_reversion, 6个)**
- NEW_MA_DEV_5 = `Div($close - Mean($close, 5), Mean($close, 5) + 1e-8)`
- NEW_MA_DEV_10 = `Div($close - Mean($close, 10), Mean($close, 10) + 1e-8)`
- NEW_MA_DEV_20 = `Div($close - Mean($close, 20), Mean($close, 20) + 1e-8)`
- NEW_MA_DEV_60 = `Div($close - Mean($close, 60), Mean($close, 60) + 1e-8)`
- NEW_ZSCORE_20 = `Div($close - Mean($close, 20), Std($close, 20) + 1e-8)`
- NEW_ZSCORE_60 = `Div($close - Mean($close, 60), Std($close, 60) + 1e-8)`

**I. 复合信号 (composite, 4个)**
- NEW_VALUE_LOWVOL = `Div(Div(1, $pb_mrq + 1e-8), Std(Div($high - $low, $close + 1e-8), 20) + 1e-8)`
- NEW_MOM_VOL_DIV_10 = `Mul(Div($close, Ref($close, 10)) - 1, 0 - Div($volume, Mean($volume, 20) + 1e-8))`
- NEW_PE_PRICE_ALIGNMENT = `Div(Div($pe_ttm, Ref($pe_ttm, 20)) - 1, Div($close, Ref($close, 20)) - 1 + 1e-8)`
- NEW_MOM_TURN_ADJ_20 = `Div(Div($close, Ref($close, 20)) - 1, Std($turnover_rate, 20) + 1e-8)`

## 4) preflight_gate
- parse_ok: pass (41/41 表达式均可解析并执行)
- complexity_level: medium (多数为 2-3 层嵌套的 Qlib 表达式)
- redundancy_flag: low (9 个全新类别，与已有 75 Accepted 因子类别交叉有限)
- data_availability: pass (仅使用 Phase 1 字段，全部可用)
- gate_notes: 3 个因子与 Baseline Alpha158 有概念重叠（MA_DEV 类似 ROC/MA, CLOSE_POS 类似 KLOW/KUP），但表达式不同。

## 5) experiment_config
- script: scripts/test_new_factor_batch.py
- market: csi1000
- start: 2020-01-01
- end: 2024-12-31
- run_id: N/A (非 MLflow 管理)
- output_paths:
  - outputs/new_factor_batch_results.csv
  - data/factor_library.db (已 backfill)

## 6) layer_a_single_factor

| Rank | Factor | Category | RankIC | ICIR | t-stat | p-value | Status |
|------|--------|----------|--------|------|--------|---------|--------|
| **1** | **NEW_TURN_QUANTILE_120** | val_quantile | -0.0305 | **-0.394** | -13.7 | 0.0000 | **Accepted** |
| 2 | NEW_VALUE_LOWVOL | composite | +0.0388 | +0.322 | +11.2 | 0.0000 | Accepted |
| 3 | NEW_CFP_TURN | val_turn | -0.0167 | -0.304 | -10.6 | 0.0000 | Accepted |
| 4 | NEW_TURN_PEAK_20 | turn_regime | -0.0144 | -0.279 | -9.7 | 0.0000 | Accepted |
| 5 | NEW_AMT_PER_RANGE | microstructure | -0.0170 | -0.275 | -9.6 | 0.0000 | Accepted |
| 6 | NEW_VOL_CONC_5 | microstructure | -0.0128 | -0.268 | -9.3 | 0.0000 | Accepted |
| 7 | NEW_TURN_PERSIST_20 | turn_regime | -0.0139 | -0.255 | -8.9 | 0.0000 | Accepted |
| 8 | NEW_BP_TURN | val_turn | -0.0222 | -0.247 | -8.6 | 0.0000 | Accepted |
| 9 | NEW_PRICE_IMPACT_20 | efficiency | +0.0195 | +0.240 | +8.4 | 0.0000 | Accepted |
| 10 | NEW_PB_CV_60 | val_vol | -0.0271 | -0.233 | -8.1 | 0.0000 | Accepted |
| 11 | NEW_PS_CV_60 | val_vol | -0.0261 | -0.232 | -8.1 | 0.0000 | Accepted |
| 12 | NEW_MOM_VOL_DIV_10 | composite | +0.0209 | +0.210 | +7.3 | 0.0000 | Accepted |
| 13 | NEW_PE_CV_60 | val_vol | -0.0183 | -0.207 | -7.2 | 0.0000 | Accepted |
| 14 | NEW_ZSCORE_20 | mean_reversion | -0.0233 | -0.205 | -7.1 | 0.0000 | Accepted |
| 15 | NEW_MA_DEV_20 | mean_reversion | -0.0236 | -0.200 | -7.0 | 0.0000 | Accepted |
| 16 | NEW_ZSCORE_60 | mean_reversion | -0.0240 | -0.197 | -6.9 | 0.0000 | Accepted |
| 17 | NEW_PE_QUANTILE_120 | val_quantile | -0.0112 | -0.183 | -6.4 | 0.0000 | Accepted |
| 18 | NEW_MA_DEV_10 | mean_reversion | -0.0199 | -0.175 | -6.1 | 0.0000 | Accepted |
| 19 | NEW_MA_DEV_60 | mean_reversion | -0.0227 | -0.170 | -5.9 | 0.0000 | Accepted |
| 20 | NEW_MOM_TURN_ADJ_20 | composite | -0.0160 | -0.170 | -5.9 | 0.0000 | Accepted |
| 21 | NEW_RET_PER_VOL_5 | efficiency | +0.0099 | +0.166 | +5.8 | 0.0000 | Accepted |
| 22 | NEW_AMIHUD_20 | efficiency | +0.0165 | +0.158 | +5.5 | 0.0000 | Accepted |
| 23 | NEW_PB_QUANTILE_120 | val_quantile | -0.0176 | -0.147 | -5.1 | 0.0000 | Accepted |
| 24 | NEW_PE_QUANTILE_240 | val_quantile | -0.0076 | -0.138 | -4.8 | 0.0000 | Accepted |
| 25 | NEW_MA_DEV_5 | mean_reversion | -0.0141 | -0.130 | -4.5 | 0.0000 | Accepted |
| 26 | NEW_TURN_TREND | turn_regime | -0.0074 | -0.129 | -4.5 | 0.0000 | Accepted |
| 27 | NEW_CLOSE_QUANTILE_120 | val_quantile | -0.0171 | -0.128 | -4.5 | 0.0000 | Accepted |
| 28 | NEW_MOM_ACCEL_5 | momentum_diff | -0.0105 | -0.122 | -4.2 | 0.0000 | Accepted |
| 29 | NEW_MOM_DIFF_5_20 | momentum_diff | +0.0118 | +0.116 | +4.1 | 0.0001 | Accepted |
| 30 | NEW_CLOSE_POS | microstructure | -0.0074 | -0.093 | -3.2 | 0.0013 | Accepted |
| 31 | NEW_VWAP_DEV_MA10 | microstructure | +0.0081 | +0.092 | +3.2 | 0.0013 | Accepted |
| 32 | NEW_EP_TURN_SURGE | val_turn | +0.0060 | +0.082 | +2.9 | 0.0042 | Accepted |
| - | NEW_CLOSE_POS_MA10 | microstructure | -0.0050 | -0.057 | -2.0 | 0.0464 | Candidate |
| - | NEW_MOM_DIFF_5_60 | momentum_diff | +0.0082 | +0.065 | +2.3 | 0.0241 | Candidate |

**Rejected (p>0.05, 7个):** NEW_PE_PRICE_VOL_RATIO, NEW_SP_AMT_SURGE, NEW_MOM_DIFF_20_60, NEW_MOM_DIFF_10_60, NEW_VWAP_DEV, NEW_AMT_SKEW_20, NEW_PE_PRICE_ALIGNMENT

**Summary:**
- Total tested: 41
- Accepted (p<0.01): **32** (78%)
- Candidate (p<0.05): 2 (5%)
- Rejected: 7 (17%)
- rank_ic_mean range: [-0.0305, +0.0388]
- rank_icir range: [-0.394, +0.322]
- n_days: 1211 (all factors)
- layer_a_result: **pass** (32/41 显著, FDR 校正后仍≥30 个通过)

## 7) layer_b_portfolio
- executed: no
- not_run_reason: 本轮为 Phase 1 大规模单因子筛选，Layer B 组合验证将在 Top-N 因子确定后的 Phase 2 统一执行。
- excess_return_with_cost: N/A
- ir_with_cost: N/A
- max_drawdown: N/A
- layer_b_result: not_run

## 8) decision
- decision: **Promote**
- decision_basis: 32/41 因子达到 p<0.01 硬门槛。最优因子 NEW_TURN_QUANTILE_120 (ICIR=-0.394) 超越全库之前最优 CSTM_AMT_CV_20 (-0.388) 登顶 #1。9 个全新类别（val_vol, val_turn, momentum_diff, val_quantile, turn_regime, microstructure, efficiency, mean_reversion, composite）中 8 个有显著因子产出。所有结果已 backfill 至 factor_library.db 并输出到 outputs/new_factor_batch_results.csv。
- failure_mode: N/A
- next_action: 将 Top 新因子纳入 TopN 因子组合，进行 LightGBM 模型训练 + Layer B 组合回测验证。

## 9) evidence_links
- db_query: `uv run python scripts/factor_db_cli.py list --market csi1000 --top 30`
- run_id: N/A
- outputs:
  - outputs/new_factor_batch_results.csv
  - scripts/test_new_factor_batch.py (测试脚本)
  - data/factor_library.db (已 backfill 41 因子)

## 10) Key Findings

### 全库 Top 5（含新因子后）
| # | Factor | ICIR | Category | Source |
|---|--------|------|----------|--------|
| 1 | **NEW_TURN_QUANTILE_120** | **-0.394** | val_quantile | **NEW** |
| 2 | CSTM_AMT_CV_20 | -0.388 | volume | Existing |
| 3 | CSTM_VOL_CV_10 | -0.380 | volume | Existing |
| 4 | CSTM_RANGE_VOL_10 | -0.335 | range | Existing |
| 5 | **NEW_VALUE_LOWVOL** | **+0.322** | composite | **NEW** |

### 关键发现
1. **换手率分位数 (TURN_QUANTILE_120)** 是最强预测因子：当前换手率相对于过去120日范围的位置。低分位（冷门期）预示正收益，高分位（热门期）预示负收益。
2. **价值+低波动复合 (VALUE_LOWVOL)** 是唯一 ICIR > 0.3 的正向因子：低 PB + 低日内波动率 → 正收益。这是经典的"质量价值"信号在 A 股小盘的验证。
3. **现金流估值×换手率 (CFP_TURN)** ICIR=-0.304：暗示在 CSI1000 中，现金流估值比 PE/PB 有更强的定价效率。
4. **均值回归信号全面显著**：所有 6 个 MA 偏离 / Z-score 因子均通过 p<0.01。20 日回望窗口 ICIR 最优 (-0.205)。
5. **CSI1000 的负 IC 主导模式继续验证**：32 个显著因子中 24 个为负 IC（低值 → 正收益），一致地反映小盘股的均值回归 + 低波动溢价特征。
