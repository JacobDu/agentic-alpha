# HEA-2026-02-18-03

## 1) hea_round
- hea_round: HEA-2026-02-18-03
- date: 2026-02-18
- owner: agent

## 2) hypothesis
- hypothesis: 将正交的高效因子进行组合（加法/乘法/比率/z-score），可产生比单因子更强的预测信号，因为组合因子捕捉了多维度信息的交互效应。
- market_logic: HEA-01/02 筛选出的顶级因子分属不同维度（换手率分位、成交量波动、跳空频率、现金流估值等），pairwise |ρ| < 0.35，组合后的因子可同时利用多个独立信息源。特别是"低换手率分位 + 低量波动"组合，双重过滤出交易冷淡期的股票，这类股票历史上展现更强的均值回归收益。
- expected_direction: 负 IC 为主（组合后低值 → 正收益）

## 3) factor_expression_list

**A. 加法组合 (composite_add, 4个)**
- COMP_TQ120_p_AMTCV20 = `Add(TQ120, AMTCV20)` — TURN_QUANTILE_120 + AMT_CV_20
- COMP_TQ120_p_GAPFREQ = `Add(TQ120, GAPFREQ)` — TURN_QUANTILE_120 + GAP_FREQ_20
- COMP_VOLCV10_p_CFP = `Add(VOLCV10, CFPTURN)` — VOL_CV_10 + CFP_TURN
- COMP_GAPFREQ_p_VOLTREND = `Add(GAPFREQ, VOLTREND)` — GAP_FREQ + VOL_TREND

**B. 乘法交互 (composite_mul, 9个)**
- COMP_TQ120_x_AMTCV20 = `Mul(TQ120, AMTCV20)` — 换手分位 × 量波动
- COMP_TQ120_x_GAPFREQ = `Mul(TQ120, GAPFREQ)` — 换手分位 × 跳空频率
- COMP_VOLCV10_x_CFP = `Mul(VOLCV10, CFPTURN)` — 量CV × 现金流估值
- COMP_VOLCV10_x_AMTRANGE = `Mul(VOLCV10, AMTRANGE)` — 量CV × 成交密度
- COMP_GAPFREQ_x_VOLTREND = `Mul(GAPFREQ, VOLTREND)` — 跳空 × 量趋势
- COMP_VWAPBIAS_x_VOLCONC = `Mul(VWAPBIAS, VOLCONC)` — VWAP偏差 × 量集中度
- COMP_TQ120_x_negOVN = `Mul(TQ120, -OVN)` — 换手分位 × 日内强势
- COMP_OVNINTRA_x_REVERT = `Mul(OVN_DIV, REVERT)` — 隔夜/日内 × 条件反转
- COMP_HIGHVRET_x_SIGNCORR = `Mul(HIGHVRET, SIGNCORR)` — 放量日收益 × 涨跌量相关

**C. 比率组合 (composite_ratio, 1个)**
- COMP_VALLV_div_CFP = `Div(VALUE_LOWVOL, CFPTURN)` — 质量价值 / 现金流活跃度

**D. 三元交互 (composite_triple, 1个)**
- COMP_TRIPLE_TQ_CV_GAP = `Mul(Mul(TQ120, AMTCV20), GAPFREQ)` — 换手分位 × 量CV × 跳空

**E. Z-score 标准化 (composite_zscore, 2个)**
- COMP_ZSCORE_TQ_AMTCV = `Z(TQ120) + Z(AMTCV20)` — 时序标准化后加法
- COMP_ZSCORE_TQ_GAP_CV = `Z(TQ120) + Z(GAPFREQ) + Z(VOLCV10)` — 三因子z-score

**F. 其他复合 (2个)**
- COMP_OVNINTRA_p_REVERT = `Add(OVN_DIV, REVERT)` — 隔夜分歧 + 条件反转
- COMP_INTRARET_x_AMTRANGE = `Mul(INTRARET, AMTRANGE)` — 日内收益 × 成交密度
- COMP_VALLV_x_negCFP = `Mul(VALLV, -CFP)` — 价值低波 × 反向现金流

## 4) preflight_gate
- parse_ok: pass (20/20 表达式均可解析)
- complexity_level: high (多数为 2-3 层嵌套组合，三元交互达 4 层)
- redundancy_flag: medium (组合因子与成分因子必然有相关性，但组合间通过选择不同正交对保持差异)
- data_availability: pass (全部基于已验证的 Phase 1 字段)
- gate_notes: 组合因子的 IC 提升来源于：(1) 多信息源交互增强 (2) 极端值联合过滤效应。需注意过拟合风险——组合因子的构造本身是数据驱动的。

## 5) experiment_config
- script: scripts/test_composite_factors.py
- market: csi1000
- start: 2020-01-01
- end: 2024-12-31
- run_id: N/A
- output_paths:
  - outputs/composite_factor_results.csv
  - data/factor_library.db (已 backfill)

## 6) layer_a_single_factor

| Rank | Factor | Category | RankIC | ICIR | t-stat | Status |
|------|--------|----------|--------|------|--------|--------|
| **1** | **COMP_TRIPLE_TQ_CV_GAP** | composite_triple | -0.0392 | **-0.469** | -16.3 | **Accepted** |
| **2** | **COMP_TQ120_p_AMTCV20** | composite_add | -0.0330 | **-0.468** | -16.3 | **Accepted** |
| 3 | COMP_VOLCV10_p_CFP | composite_add | -0.0242 | -0.453 | -15.8 | Accepted |
| 4 | COMP_TQ120_x_GAPFREQ | composite_mul | -0.0386 | -0.450 | -15.7 | Accepted |
| 5 | COMP_TQ120_x_AMTCV20 | composite_mul | -0.0331 | -0.445 | -15.5 | Accepted |
| 6 | COMP_VALLV_div_CFP | composite_ratio | +0.0237 | +0.434 | +15.1 | Accepted |
| 7 | COMP_GAPFREQ_x_VOLTREND | composite_mul | -0.0377 | -0.420 | -14.6 | Accepted |
| 8 | COMP_VWAPBIAS_x_VOLCONC | composite_mul | -0.0432 | -0.401 | -14.0 | Accepted |
| 9 | COMP_TQ120_p_GAPFREQ | composite_add | -0.0311 | -0.400 | -13.9 | Accepted |
| 10 | COMP_VOLCV10_x_CFP | composite_mul | -0.0203 | -0.360 | -12.5 | Accepted |
| 11 | COMP_VOLCV10_x_AMTRANGE | composite_mul | -0.0222 | -0.354 | -12.3 | Accepted |
| 12 | COMP_GAPFREQ_p_VOLTREND | composite_add | -0.0238 | -0.302 | -10.5 | Accepted |
| 13 | COMP_TQ120_x_negOVN | composite_mul | -0.0213 | -0.302 | -10.5 | Accepted |
| 14 | COMP_ZSCORE_TQ_GAP_CV | composite_zscore | -0.0156 | -0.276 | -9.6 | Accepted |
| 15 | COMP_INTRARET_x_AMTRANGE | composite_mul | -0.0218 | -0.276 | -9.6 | Accepted |
| 16 | COMP_HIGHVRET_x_SIGNCORR | composite_mul | +0.0163 | +0.252 | +8.8 | Accepted |
| 17 | COMP_OVNINTRA_p_REVERT | composite_add | +0.0251 | +0.237 | +8.3 | Accepted |
| 18 | COMP_ZSCORE_TQ_AMTCV | composite_zscore | -0.0123 | -0.236 | -8.2 | Accepted |
| 19 | COMP_OVNINTRA_x_REVERT | composite_mul | -0.0159 | -0.228 | -7.9 | Accepted |
| - | COMP_VALLV_x_negCFP | composite_mul | -0.0032 | -0.049 | -1.7 | Rejected |

**Summary:**
- Total tested: 20
- Accepted (p<0.01): **19** (95%)
- Rejected: 1 (5%)
- ICIR range: [-0.469, +0.434]
- n_days: 1211
- layer_a_result: **pass** (19/20 显著)

## 7) layer_b_portfolio
- executed: no
- not_run_reason: Phase 1 单因子层评估，Layer B 将在 Phase 2 统一执行
- excess_return_with_cost: N/A
- ir_with_cost: N/A
- max_drawdown: N/A
- layer_b_result: not_run

## 8) decision
- decision: **Promote**
- decision_basis: 19/20 组合因子通过 p<0.01 硬门槛（95% 通过率）。最强因子 COMP_TRIPLE_TQ_CV_GAP (ICIR=-0.469) 较此前全库最优 NEW_TURN_QUANTILE_120 (-0.394) 提升 **19%**。前 9 个组合因子全部超过此前 #1 的 ICIR。加法组合和乘法交互均有效，三元交互和加法组合略优于二元乘法。仅 COMP_VALLV_x_negCFP 未通过（正/负方向冲突导致信号抵消）。
- failure_mode: N/A
- next_action: 将 Top 组合因子纳入 Phase 2 LightGBM 训练。需注意组合因子与成分因子的 multicollinearity，模型中不宜同时使用组合因子和其成分因子。

## 9) evidence_links
- db_query: `uv run python scripts/factor_db_cli.py list --market csi1000 --top 20`
- run_id: N/A
- outputs:
  - outputs/composite_factor_results.csv
  - outputs/top40_correlation_matrix.csv
  - scripts/test_composite_factors.py
  - scripts/analyze_ortho_pairs.py
  - data/factor_library.db (已 backfill 20 因子)

## 10) Key Findings

### 全库 Top 10（合并三轮后）

| # | Factor | ICIR | Category | Source | vs 成分 ICIR |
|---|--------|------|----------|--------|-------------|
| **1** | **COMP_TRIPLE_TQ_CV_GAP** | **-0.469** | composite_triple | **HEA-03** | TQ(-0.394)+CV(-0.388)+GAP(-0.364) |
| **2** | **COMP_TQ120_p_AMTCV20** | **-0.468** | composite_add | **HEA-03** | TQ(-0.394)+CV(-0.388) |
| **3** | **COMP_VOLCV10_p_CFP** | **-0.453** | composite_add | **HEA-03** | CV(-0.380)+CFP(-0.304) |
| **4** | **COMP_TQ120_x_GAPFREQ** | **-0.450** | composite_mul | **HEA-03** | TQ(-0.394)+GAP(-0.364) |
| **5** | **COMP_TQ120_x_AMTCV20** | **-0.445** | composite_mul | **HEA-03** | TQ(-0.394)+CV(-0.388) |
| **6** | **COMP_VALLV_div_CFP** | **+0.434** | composite_ratio | **HEA-03** | VLV(+0.322)/CFP(-0.304) |
| **7** | **COMP_GAPFREQ_x_VOLTREND** | **-0.420** | composite_mul | **HEA-03** | GAP(-0.364)+VOLT(-0.299) |
| **8** | **COMP_VWAPBIAS_x_VOLCONC** | **-0.401** | composite_mul | **HEA-03** | VWAP(-0.342)+VC(-0.268) |
| **9** | **COMP_TQ120_p_GAPFREQ** | **-0.400** | composite_add | **HEA-03** | TQ(-0.394)+GAP(-0.364) |
| 10 | NEW_TURN_QUANTILE_120 | -0.394 | val_quantile | HEA-01 | (单因子) |

### 组合效果分析

1. **Top 9 组合因子全部超越此前 #1 单因子** (ICIR -0.394)，最高提升 19% (ICIR -0.469)。
2. **加法组合 vs 乘法交互**：
   - 加法 (ADD): avg ICIR = -0.406，更稳定
   - 乘法 (MUL): avg ICIR = -0.361，捕捉交互但方差更大
   - 最优加法: COMP_TQ120_p_AMTCV20 (-0.468)
   - 最优乘法: COMP_TQ120_x_GAPFREQ (-0.450)
3. **三元交互**：`TQ120 × AMTCV20 × GAPFREQ` (ICIR=-0.469) 仅略优于二元加法 (-0.468)，额外复杂度的边际收益有限。
4. **最佳正交组合对**：VOL_CV_10 × CFP_TURN (|ρ|=0.12, ICIR=-0.453)，两个中等强度因子组合后超越各自最强单因子。
5. **失败案例**：COMP_VALLV_x_negCFP (ICIR=-0.049)，价值低波 × (-现金流估值) 的信号方向冲突导致抵消。

### 市场逻辑解读

- **COMP_TRIPLE_TQ_CV_GAP**：换手率处于低分位 + 成交量波动低 + 跳空频率低 = "三重冷门"信号。这类极度平静的股票在 CSI1000 中后续回报最高，是小盘股均值回归效应的极致提纯。
- **COMP_VALLV_div_CFP**：高账面价值/低日内波动 ÷ 低现金流估值活跃度 = "沉睡的价值股"。低估值 + 低波动 + 低关注度，回归潜力最大。
